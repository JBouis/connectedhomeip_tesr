# stm32_h7_sdk.gn_helper

import("//build_overrides/build.gni")
import("//build_overrides/chip.gni")
import("//build_overrides/freertos.gni")
import("//build_overrides/mbedtls.gni")
import("//build_overrides/lwip.gni")

declare_args() {
  components_lan8742 = "${chip_root}/third_party/st/Drivers/BSP/Components/lan8742"

  # COMMON PATHS #
  cmsis = "${chip_root}/third_party/st/Drivers/CMSIS"
   
  # PATHS FOR STM32H7 FAMILY #
  stm32_h7_sdk = "${chip_root}/third_party/st/Drivers"
  stm32_h7_hal = "${chip_root}/third_party/st/Drivers/STM32H7xx_HAL_Driver"
  cmsis_device_h7 = "${chip_root}/third_party/st/Drivers/CMSIS/Device/ST/STM32H7xx"
  stm32_h7_common = "${chip_root}/examples/platform/stm32/common/NUCLEO-H753ZI"
  bsp_stm32h7xx_nucleo_144 = "${chip_root}/third_party/st/Drivers/BSP/STM32H7xx_Nucleo_144"
}

SOURCES = [
  "${components_lan8742}/lan8742.c",
  "${bsp_stm32h7xx_nucleo_144}/stm32h7xx_nucleo.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_cortex.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_cryp.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_cryp_ex.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_dfsdm.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_dfsdm_ex.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_dma.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_dma_ex.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_eth.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_exti.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_flash.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_flash_ex.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_gpio.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_hash.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_hash_ex.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_hsem.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_i2c.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_i2c_ex.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_mdma.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_pwr.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_pwr_ex.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_rcc.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_rcc_ex.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_rng.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_rng_ex.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_rtc.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_rtc_ex.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_spi.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_spi_ex.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_tim.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_tim_ex.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_uart.c",
  "${stm32_h7_hal}/Src/stm32h7xx_hal_uart_ex.c",

  "${stm32_h7_common}/Src/ethernetif.c",
  "${stm32_h7_common}/Src/app_ethernet.c",
  # "${stm32_h7_common}/Src/gpio.cpp",
  # "${stm32_h7_common}/Src/lwip.cpp",
  "${stm32_h7_common}/Src/main.cpp",
  # "${stm32_h7_common}/Src/rng.cpp",
  # "${stm32_h7_common}/Src/usart.cpp",
  "${stm32_h7_common}/Src/stm32h7xx_hal_msp.c",
  "${stm32_h7_common}/Src/stm32h7xx_hal_timebase_tim.c",
  "${stm32_h7_common}/Src/stm32h7xx_it.c",
  "${stm32_h7_common}/Src/syscalls.c",
  "${stm32_h7_common}/Src/flash_h7.c",
  "${stm32_h7_common}/Src/system_stm32h7xx.c",

  "${lwip_root}/repo/lwip/src/include/lwip/opt.h",
  "${lwip_root}/repo/lwip/src/include/lwip/apps/lwiperf.h",

  #FREERTOS
  "${freertos_root}/repo/croutine.c",
  "${freertos_root}/repo/event_groups.c",
  "${freertos_root}/repo/list.c",
  "${freertos_root}/repo/portable/GCC/ARM_CM4F/port.c",
  "${freertos_root}/repo/portable/MemMang/heap_5.c",
  "${freertos_root}/repo/queue.c",
  "${freertos_root}/repo/stream_buffer.c",
  "${freertos_root}/repo/tasks.c",
  "${freertos_root}/repo/timers.c",  
]
  
INCLUDE_DIRS = [
  "${cmsis_device_h7}/Include",
  "${cmsis}/Include",
  "${stm32_h7_hal}/Inc",
  "${stm32_h7_hal}/Inc/Legacy",
  "${bsp_stm32h7xx_nucleo_144}",
  "${components_lan8742}",

  "${stm32_h7_common}/Inc",
  "${lwip_root}/repo/lwip/src/include",
  "${chip_root}/src/lwip/stm32/",
  "${chip_root}/src/lwip/freertos/",

  #FREERTOS INCLUDES
  "${freertos_root}/repo/include",
  "${freertos_root}/repo/portable/GCC/ARM_CM4F/",
  "${freertos_root}/repo/portable",
  "${chip_root}/examples/platform/stm32/config_files"
]

DEFINES = [
  "CURRENT_TIME_NOT_IMPLEMENTED=1",
  # "CHIP_ADDRESS_RESOLVE_IMPL_INCLUDE_HEADER=<lib/address_resolve/AddressResolve_DefaultImpl.h>",
  "USE_STM32H753Z_NUCLEO",
  "LWIP_TIMEVAL_PRIVATE=0",
  "STM32H753xx",
  # "DYNAMIC_ENDPOINT_COUNT=32",
  "CONFIG_ENABLE_STM32_DEVICE_INFO_PROVIDER=0",
  "CONFIG_ENABLE_STM32_FACTORY_DATA_PROVIDER=0",
  "LWIP_IPV6=1",
  "CHIP_MINMDNS_DEFAULT_POLICY=1",
]

LIBS = [
  # add any .o/.a library here
]
  
FLAGS = [ 
]
